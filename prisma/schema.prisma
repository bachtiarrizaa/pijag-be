generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/// ==========================
/// ENUMERATIONS
/// ==========================
enum DiscountType {
  percent
  fixed
}

enum OrderStatus {
  pending
  processing
  ready
  completed
  canceled
}

enum PaymentStatus {
  pending
  paid
  failed
}

enum PaymentMethod {
  cash
  card
  ewallet
}

enum PaymentResultStatus {
  success
  failed
  refunded
}

enum TransactionType {
  income
  expense
}

/// ==========================
/// TABLES
/// ==========================

model Role {
  id          BigInt    @id @default(autoincrement())
  name        String    @unique @db.VarChar(100)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @updatedAt @db.Timestamp(6)

  users       User[]
}

model User {
  id           BigInt     @id @default(autoincrement())
  avatar       String?    @db.VarChar(255)
  name         String     @db.VarChar(100)
  username     String     @unique @db.VarChar(100)
  email        String     @unique @db.VarChar(100)
  password     String     @db.VarChar(255)
  birth_of_date DateTime? @db.Date
  phone_number String?    @db.VarChar(100)
  created_at   DateTime?  @default(now()) @db.Timestamp(6)
  updated_at   DateTime?  @updatedAt @db.Timestamp(6)

  role_id      BigInt?
  role         Role?      @relation(fields: [role_id], references: [id])
  customer     Customer?
  shifts       Shift[]
  orders       Order[]    @relation("CashierOrders")
}

model Customer {
  id          BigInt     @id @default(autoincrement())
  user_id     BigInt     @unique
  points      BigInt?    @default(0)
  created_at  DateTime?  @default(now()) @db.Timestamp(6)
  updated_at  DateTime?  @updatedAt @db.Timestamp(6)

  user        User       @relation(fields: [user_id], references: [id])
  carts       Cart[]
  wishlists   Wishlist[]
  orders      Order[]
  reviews     Review[]
}

model Category {
  id          BigInt     @id @default(autoincrement())
  name        String     @db.VarChar(100)
  created_at  DateTime?  @default(now()) @db.Timestamp(6)
  updated_at  DateTime?  @updatedAt @db.Timestamp(6)

  products    Product[]
}

model Product {
  id              BigInt     @id @default(autoincrement())
  category_id     BigInt?
  name            String     @db.VarChar(100)
  description     String?    @db.Text
  price           Decimal    @db.Decimal(10,2)
  discount_percent Decimal?  @default(0.0) @db.Decimal(5,2)
  stock           BigInt?    @default(0)
  image           String?    @db.VarChar(255)
  created_at      DateTime?  @default(now()) @db.Timestamp(6)
  updated_at      DateTime?  @updatedAt @db.Timestamp(6)

  category        Category?  @relation(fields: [category_id], references: [id])
  order_items     OrderItem[]
  cart_items      CartItem[]
  wishlists       Wishlist[]
  reviews         Review[]
}

model Wishlist {
  id           BigInt     @id @default(autoincrement())
  customer_id  BigInt
  product_id   BigInt
  created_at   DateTime?  @default(now()) @db.Timestamp(6)
  updated_at   DateTime?  @updatedAt @db.Timestamp(6)

  customer     Customer   @relation(fields: [customer_id], references: [id])
  product      Product    @relation(fields: [product_id], references: [id])
}

model Cart {
  id           BigInt     @id @default(autoincrement())
  customer_id  BigInt
  total        Decimal?   @default(0.0) @db.Decimal(10,2)
  created_at   DateTime?  @default(now()) @db.Timestamp(6)
  updated_at   DateTime?  @updatedAt @db.Timestamp(6)

  customer     Customer   @relation(fields: [customer_id], references: [id])
  items        CartItem[]
}

model CartItem {
  id               BigInt     @id @default(autoincrement())
  cart_id          BigInt
  product_id       BigInt
  quantity         Int        @default(1)
  price            Decimal    @db.Decimal(10,2)
  discount_percent Decimal?   @default(0.0) @db.Decimal(5,2)
  subtotal         Decimal    @db.Decimal(10,2)
  created_at       DateTime?  @default(now()) @db.Timestamp(6)
  updated_at       DateTime?  @updatedAt @db.Timestamp(6)

  cart             Cart       @relation(fields: [cart_id], references: [id])
  product          Product    @relation(fields: [product_id], references: [id])
}

model GlobalDiscount {
  id              BigInt       @id @default(autoincrement())
  name            String       @db.VarChar(100)
  description     String?      @db.Text
  type            DiscountType
  value           Decimal      @db.Decimal(10,2)
  min_order_amount Decimal?    @default(0.0) @db.Decimal(10,2)
  start_date      DateTime?
  end_date        DateTime?
  is_active       Boolean?     @default(true)
  created_at      DateTime?    @default(now()) @db.Timestamp(6)
  updated_at      DateTime?    @updatedAt @db.Timestamp(6)

  orders          Order[]
}

model Order {
  id                BigInt        @id @default(autoincrement())
  customer_id       BigInt
  cashier_id        BigInt
  global_discount_id BigInt?
  order_code        String        @unique
  total             Decimal       @db.Decimal(10,2)
  discount_amount   Decimal?      @default(0.0) @db.Decimal(10,2)
  final_total       Decimal       @db.Decimal(10,2)
  status            OrderStatus   @default(pending)
  payment_status    PaymentStatus @default(pending)
  created_at        DateTime?     @default(now()) @db.Timestamp(6)
  updated_at        DateTime?     @updatedAt @db.Timestamp(6)

  customer          Customer      @relation(fields: [customer_id], references: [id])
  cashier           User          @relation("CashierOrders", fields: [cashier_id], references: [id])
  global_discount   GlobalDiscount? @relation(fields: [global_discount_id], references: [id])
  order_items       OrderItem[]
  payments          Payment[]
  transactions      Transaction[]
}

model OrderItem {
  id               BigInt     @id @default(autoincrement())
  order_id         BigInt
  product_id       BigInt
  quantity         Int
  price            Decimal    @db.Decimal(10,2)
  discount_percent Decimal?   @default(0.0) @db.Decimal(5,2)
  subtotal         Decimal    @db.Decimal(10,2)
  created_at       DateTime?  @default(now()) @db.Timestamp(6)
  updated_at       DateTime?  @updatedAt @db.Timestamp(6)

  order            Order      @relation(fields: [order_id], references: [id])
  product          Product    @relation(fields: [product_id], references: [id])
}

model Payment {
  id                BigInt               @id @default(autoincrement())
  order_id          BigInt
  method            PaymentMethod
  amount            Decimal              @db.Decimal(10,2)
  status            PaymentResultStatus
  transaction_time  DateTime?
  created_at        DateTime?            @default(now()) @db.Timestamp(6)
  updated_at        DateTime?            @updatedAt @db.Timestamp(6)

  order             Order                @relation(fields: [order_id], references: [id])
  transactions      Transaction[]
}

model Shift {
  id           BigInt     @id @default(autoincrement())
  user_id      BigInt
  start_time   DateTime?
  end_time     DateTime?
  cash_start   Decimal?   @default(0.0) @db.Decimal(10,2)
  cash_end     Decimal?   @default(0.0) @db.Decimal(10,2)
  notes        String?    @db.Text
  created_at   DateTime?  @default(now()) @db.Timestamp(6)
  updated_at   DateTime?  @updatedAt @db.Timestamp(6)

  user         User       @relation(fields: [user_id], references: [id])
  transactions Transaction[]
}

model Transaction {
  id           BigInt          @id @default(autoincrement())
  shift_id     BigInt
  order_id     BigInt?
  payment_id   BigInt?
  type         TransactionType
  amount       Decimal          @db.Decimal(10,2)
  description  String?          @db.VarChar(255)
  created_at   DateTime?        @default(now()) @db.Timestamp(6)
  updated_at   DateTime?        @updatedAt @db.Timestamp(6)

  shift        Shift            @relation(fields: [shift_id], references: [id])
  order        Order?           @relation(fields: [order_id], references: [id])
  payment      Payment?         @relation(fields: [payment_id], references: [id])
}

model Review {
  id           BigInt     @id @default(autoincrement())
  customer_id  BigInt
  product_id   BigInt
  rating       Int
  comment      String?    @db.Text
  created_at   DateTime?  @default(now()) @db.Timestamp(6)
  updated_at   DateTime?  @updatedAt @db.Timestamp(6)

  customer     Customer   @relation(fields: [customer_id], references: [id])
  product      Product    @relation(fields: [product_id], references: [id])
}